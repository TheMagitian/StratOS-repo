# Maintainer: ZeStig <zestig@duck.com>
pkgname=stratos-waybar-config
pkgver=1.0
pkgrel=0
pkgdesc="StratOS Waybar config"
arch=('x86_64')
url="https://github.com/StratOS-Linux/StratOS-waybar-config"
license=('GPL')
depends=('bash' 'waybar') 

build() {
    # Clone the repo directly into the source directory
    git clone "$url" "$srcdir/StratOS-waybar-config"
    echo "$srcdir"
}

package() {
    mkdir -p $pkgdir/etc/skel/.config/waybar

    config_paths=( "$HOME/.config/waybar" )

    config_exists=false
    for config in "${config_paths[@]}"; do
        if [ -e "$config" ]; then
            config_exists=true
            break
        fi
    done  

    if [ "$config_exists" = true ]; then
        cp -r $srcdir/StratOS-waybar-config/* $pkgdir/etc/skel/.config/waybar/
        echo "The configuration files have been installed in /etc/skel/.config/waybar."
        echo "You may copy the files manually if you wish to overwrite your current waybar configuration."
    else
        if [ "${FORCE_INSTALL}" = "false" ]; then
            read -p "No waybar configuration files found. Do you want to install the StratOS waybar configuration in .config/waybar? (y/n): " user_input
            if [[ $user_input =~ ^[Yy]$ ]]; then
                mkdir -p $HOME/.config/waybar
                cp -r $srcdir/StratOS-waybar-config/* $HOME/.config/waybar/
            else
                cp -r $srcdir/StratOS-waybar-config/* $pkgdir/etc/skel/.config/waybar/
                echo "The configuration files have been installed in /etc/skel/.config/waybar."
                echo "You may copy the files manually if you wish to overwrite your current waybar configuration."
            fi
        fi
        
        if [ "${FORCE_INSTALL}" = "true" ]; then
            cp -r $srcdir/StratOS-waybar-config/* $pkgdir/etc/skel/.config/waybar/
            echo "The configuration files have been installed in /etc/skel/.config/waybar."
            echo "You may copy the files manually if you wish to overwrite your current waybar configuration."
        fi
    fi
}

pkgpostrm() {
    # Clean up the configuration directory in /etc/skel when the package is removed
    rm -rf /etc/skel/.config/waybar
}
