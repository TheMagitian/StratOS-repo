# Maintainer: ZeStig <zestig@duck.com>
pkgname=stratos-starship-config
pkgver=1.0
pkgrel=0
pkgdesc="Starship shell prompt configuration for StratOS"
arch=('x86_64')
url="https://github.com/StratOS-Linux/StratOS-starship-config"
license=('GPL')
depends=('bash' 'starship') 

build() {
    git clone $url
    echo $srcdir
}

package() {
    mkdir -p $pkgdir/etc/skel/.config/starship

    config_paths=( "$HOME/.config/starship" "$HOME/.config/starship.toml")

    config_exists=false
    for config in "${config_paths[@]}"; do
        if [ -e "$config" ]; then
            config_exists=true
            break
        fi
    done  

    if [ "$config_exists" = true ]; then
        cp -r $srcdir/StratOS-starship-config/* $pkgdir/etc/skel/.config/
        echo "The configuration files have been installed in /etc/skel/.config/starship."
        echo "You may copy the files manually if you wish to overwrite your current starship configuration."
    else
        if [ "${FORCE_INSTALL}" = "false" ]; then
            read -p "No starship configuration files found. Do you want to install the StratOS starship configuration in .config/starship? (y/n): " user_input
            if [[ $user_input =~ ^[Yy]$ ]]; then
                mkdir -p $HOME/.config/starship
                cp -r $srcdir/StratOS-starship-config/* $HOME/.config/
            else
                cp -r $srcdir/StratOS-starship-config/* $pkgdir/etc/skel/.config/
                echo "The configuration files have been installed in /etc/skel/.config."
                echo "You may copy the files manually if you wish to overwrite your current starship configuration."
            fi
        fi
        
        if [ "${FORCE_INSTALL}" = "true" ]; then
            cp -r $srcdir/StratOS-starship-config/* $pkgdir/etc/skel/.config/
            echo "The configuration files have been installed in /etc/skel/.config/starship."
            echo "You may copy the files manually if you wish to overwrite your current starship configuration."
        fi
    fi
}

pkgpostrm() {
  rm -rf /etc/skel/.config/starship*
}
